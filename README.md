# pfcontext

## Обновление скрипта ContextOnly

1. Скопируйте файл `pfSense/etc/context.d/ContextOnly` из этого репозитория на устройство pfSense по SSH или через `scp`:
   ```sh
   scp pfSense/etc/context.d/ContextOnly root@<pfSense-IP>:/etc/context.d/ContextOnly
   ```
2. На устройстве pfSense сделайте файл исполняемым, если он потерял права после копирования:
   ```sh
   chmod +x /etc/context.d/ContextOnly
   ```
3. При следующем запуске службы контекста (`/etc/rc.d/context onestart`) изменения будут считаны именно из `/etc/context.d/ContextOnly`.

> **Важно.** Все правки сохраняются в файле `pfSense/etc/context.d/ContextOnly` внутри репозитория. При деплое используйте именно его, файл `pfSense/etc/context.d/old/ContextOnly` оставлен только для справки.

## DHCP сервер

Скрипт явно выключает DHCP на всех интерфейсах, которые настраиваются из переменных `ETHx_*`, если для них не заданы диапазоны `ETHx_DHCP_START` и `ETHx_DHCP_END`. Это предотвращает автоматическое включение сервиса pfSense по умолчанию. Чтобы включить DHCP, передайте оба параметра с нужным диапазоном выдачи адресов.

## Типы интерфейсов

Для ручного назначения ролей сетевых портов используйте переменные `ETHx_TYPE` или `ETHERNETx_TYPE`. Допустимые значения:

- `lan`
- `wan`
- `optN`, где `N` — число без ведущих нулей

Если заданы явные значения `lan` или `wan`, скрипт зарезервирует их до тех пор, пока не встретит интерфейс с подходящим MAC-адресом, поэтому автоматическая логика не «перехватит» роль у заданного вручную порта, даже если он обрабатывается позже. Остальные интерфейсы получают последовательные `OPT`-имена.
